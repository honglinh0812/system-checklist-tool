ID,Name,Command,Extract,Comparator,Reference Value
1a,tach_var_ra_khoi_source - detect RDO,dmidecode -t system | grep -w RDO,raw,non_empty,
1b,tach_var_ra_khoi_source - /var partition present,grep -w '\s/var\s' /etc/fstab,raw,non_empty,
2a,phan_vung_ud_ko_nam_chung_source - app partitions exist,grep -Ev '^\s*#' /etc/fstab | grep -Ewv '/$|/var$|/dev/shm$|/home$|/usr$|/proc$|/sys$|/dev/pts$|/opt$|swap|/boot$|/boot/efi$',raw,non_empty,
3a,timezone,date +'%Z %z',regex:([+\-]\d{4}),eq,700
4a,sudoers1 - '%sudo ALL=(ALL:ALL) ALL' must NOT exist,grep -Ev '^\s*#' /etc/sudoers | egrep -E '^\s*%sudo\s+ALL=\(ALL:ALL\)\s+ALL',raw,empty,
5a,sudoers2 - '%admin ALL=(ALL) ALL' must NOT exist,grep -Ev '^\s*#' /etc/sudoers | egrep -E '^\s*%admin\s+ALL=\(ALL\)\s+ALL',raw,empty,
6a,sudoers3 - per user rule must NOT exist (user={{user}}),grep -Ev '^\s*#' /etc/sudoers | egrep -w '^{{user}}\b' | grep -F 'ALL=(ALL:ALL) ALL',raw,empty,
7a,ud_ko_dung_root - ensure no root java/tomcat/jre/jdk/kubelet,ps -ef | grep '^root ' | egrep 'java|tomcat|jre|jdk|kubelet' | grep -v grep,raw,empty,
8a,duphong_bond1 - ensure no root java/tomcat/jre/jdk/kubelet,ps -ef | grep '^root ' | egrep 'java|tomcat|jre|jdk|kubelet' | grep -v grep,raw,empty,
9a,duphong_bond2 - detect VMware/RDO,dmidecode -t system | egrep -w 'VMware|RDO',raw,non_empty,
9b,duphong_bond2 - bonds count >= 1 (physical only),ip -o link show | awk -F': ' '{print $2}' | sed 's/@.*//' | grep -E '^bond[0-9]+$' | wc -l,raw,int_ge,1
9c,duphong_bond2 - bond {{bond}} has >=2 slaves,grep -c '^Slave Interface' /proc/net/bonding/{{bond}},raw,int_ge,2
9d,duphong_bond2 - each slave of {{bond}} is up,awk '/^Slave Interface:/{f=1;next} f&&/^MII Status:/{print $3;f=0}' /proc/net/bonding/{{bond}},per_line:raw,per_line:in,up
10a,duphong_bond3 - detect VMware/RDO,dmidecode -t system | egrep -w 'VMware|RDO',raw,non_empty,
10b,duphong_bond3 - bonds count >= 1 (physical only),ip -o link show | awk -F': ' '{print $2}' | sed 's/@.*//' | grep -E '^bond[0-9]+$' | wc -l,raw,int_ge,1
10c,duphong_bond3 - bond {{bond}} mode allowed,grep -E '^Bonding Mode:' /proc/net/bonding/{{bond}} | awk -F': ' '{print $2}' | awk '{print $1}',raw,in,round-robin|active-backup|balance-xor|broadcast|802.3ad|balance-tlb|balance-alb
11a,san_multipath - list devices,"dmsetup status | awk '$3!=""linear""{print $1}' | sed 's/://g' | grep -v 'p[0-9]$' | grep -v No",per_line:raw,per_line:non_empty,
11b,san_multipath - device {{line}} has >=4 running paths,multipath -ll {{line}} | grep running$ | wc -l,raw,int_ge,4
12a,kdump_service - must be active,systemctl is-active kdump-tools,raw,eq,active
13a,sendmail_off - must NOT be active,systemctl is-active sendmail,raw,neq,active
14a,postfix_off - must NOT be active,systemctl is-active postfix,raw,neq,active
15a,bash_thay_dash1 - all users must use /bin/bash,"awk -F: '($3>=1000 && $1!=""nobody""){print $7}' /etc/passwd | grep -v bash",raw,empty,
16a,bash_thay_dash2 - default shell must be bash,grep -E '^SHELL=/bin/bash' /etc/default/useradd,raw,non_empty,
17a,bo_card_mang_ao - no virbr interface,ifconfig -a | grep virbr,raw,empty,
18a,appamor_disable - must NOT be active,systemctl is-active apparmor,raw,neq,active
19a,nf_conntrack_max - file must exist,test -f /proc/sys/net/nf_conntrack_max && echo exists || echo missing,raw,eq,exists
19b,nf_conntrack_max - value must be >=524288,cat /proc/sys/net/nf_conntrack_max,raw,int_ge,524288
20a,hashsize - file must exist,test -f /proc/sys/net/netfilter/nf_conntrack_buckets && echo exists || echo missing,raw,eq,exists
20b,hashsize - value must be >=131072,cat /proc/sys/net/netfilter/nf_conntrack_buckets,raw,int_ge,131072
21a,pass_never_expired - list bash users,cat /etc/passwd | grep /bin/bash | grep -v ^# | grep -v nfsnobody | awk -F: '($3>=400){print $1}',per_line:user,per_line:non_empty,
21b,pass_never_expired - {{user}} must never expire,chage -l {{user}} | grep 'Password expires' | awk '{print $4}',raw,eq,never
22a,max_open_file_user - list bash users,cat /etc/passwd | grep /bin/bash | grep -v ^# | grep -v nfsnobody | awk -F: '($3>=400){print $1}',per_line:user,per_line:non_empty,
22b,max_open_file_user - {{user}} has nofile limit,cat /etc/security/limits.conf | grep -v ^# | grep -w {{user}} | grep -v soft | grep -w nofile,raw,non_empty,
23a,max_process_user - list bash users,cat /etc/passwd | grep /bin/bash | grep -v ^# | grep -v nfsnobody | awk -F: '($3>=400){print $1}',per_line:user,per_line:non_empty,
23b,max_process_user - {{user}} has nproc limit,cat /etc/security/limits.conf | grep -v ^# | grep -w {{user}} | grep -v soft | grep -w nproc,raw,non_empty,
24a,max_open_file_user (dup) - list bash users,cat /etc/passwd | grep /bin/bash | grep -v ^# | grep -v nfsnobody | awk -F: '($3>=400){print $1}',per_line:user,per_line:non_empty,
24b,max_open_file_user (dup) - {{user}} has nproc limit,cat /etc/security/limits.conf | grep -v ^# | grep -w {{user}} | grep -v soft | grep -w nproc,raw,non_empty,
25a,cupsd_off - must NOT be active,systemctl status cups | grep 'Active: active',raw,empty,
26a,bluetooth_off - must NOT be active,systemctl status bluetooth | grep 'Active: active',raw,empty,
27a,per_user_trong_groupsudo1 - pam_wheel required,cat /etc/pam.d/su | grep -v ^# | grep -w auth | grep -w required | grep -w pam_wheel.so,raw,non_empty,
28a,per_user_trong_groupsudo2 - list shell users,cat /etc/passwd | grep sh$ | grep -v ^# | grep -v nfsnobody | awk -F: '($3>=400){print $1}',per_line:user,per_line:non_empty,
28b,per_user_trong_groupsudo2 - {{user}} not in sudo,cat /etc/group | grep sudo | grep {{user}},raw,empty,
29a,per_user_trong_groupsudo3 - list shell users,cat /etc/passwd | grep sh$ | grep -v ^# | grep -v nfsnobody | awk -F: '($3>=400){print $1}',per_line:user,per_line:non_empty,
29b,per_user_trong_groupsudo3 - {{user}} not in adm,cat /etc/group | grep adm | grep {{user}},raw,empty,
30a,password1 - libpam-pwquality installed,dpkg -s libpam-pwquality | grep 'ok installed',raw,non_empty,
31a,password2 - minlen=8,cat /etc/security/pwquality.conf | grep -v ^# | grep -w 'minlen = 8',raw,non_empty,
32a,password3 - dcredit=-1,cat /etc/security/pwquality.conf | grep -v ^# | grep -w 'dcredit = -1',raw,non_empty,
33a,password4 - ucredit=-1,cat /etc/security/pwquality.conf | grep -v ^# | grep -w 'ucredit = -1',raw,non_empty,
34a,password5 - lcredit=-1,cat /etc/security/pwquality.conf | grep -v ^# | grep -w 'lcredit = -1',raw,non_empty,
35a,password6 - ocredit=-1,cat /etc/security/pwquality.conf | grep -v ^# | grep -w 'ocredit = -1',raw,non_empty,
36a,password7 - maxrepeat=3,cat /etc/security/pwquality.conf | grep -v ^# | grep -w 'maxrepeat = 3',raw,non_empty,
37a,password8 - enforcing=1,cat /etc/security/pwquality.conf | grep -v ^# | grep -w 'enforcing = 1',raw,non_empty,
38a,password9 - retry=3,cat /etc/security/pwquality.conf | grep -v ^# | grep -w 'retry = 3',raw,non_empty,
39a,password10 - enforce_for_root,cat /etc/security/pwquality.conf | grep -v ^# | grep -w 'enforce_for_root',raw,non_empty,
40a,pass_encryp_1 - pam_unix sha512,cat /etc/pam.d/common-password | grep -v ^# | grep -w password | grep -w pam_unix.so | grep -w sha512,raw,non_empty,
41a,pass_encryp_2 - remember=5,cat /etc/pam.d/common-password | grep -v ^# | grep -w password | grep -w pam_pwhistory.so | grep -w 'remember=5',raw,non_empty,
42a,thuat_toan_mahoa - ENCRYPT_METHOD=SHA512,cat /etc/login.defs | grep -v ^# | grep -w ENCRYPT_METHOD | grep -w SHA512,raw,non_empty,
43a,cau_hinh_ssh_protocol - Protocol 2,cat /etc/ssh/sshd_config | grep -v ^# | grep -w 'Protocol 2',raw,non_empty,
44a,cau_hinh_ssh_permitrootlogin - PermitRootLogin no,cat /etc/ssh/sshd_config | grep -v ^# | grep -w 'PermitRootLogin no',raw,non_empty,
45a,cau_hinh_ssh_allowusers - list bash users,cat /etc/passwd | grep /bin/bash | grep -v ^# | grep -v nfsnobody | awk -F: '($3>=400){print $1}',per_line:user,per_line:non_empty,
45b,cau_hinh_ssh_allowusers - {{user}} in AllowUsers,cat /etc/ssh/sshd_config | grep -v ^# | grep -w AllowUsers | grep -w {{user}},raw,non_empty,
46a,tudong_off_ssh_1 - list bash users,cat /etc/passwd | grep /bin/bash | grep -v ^# | grep -v nfsnobody | awk -F: '($3>=400){print $1}',per_line:user,per_line:non_empty,
46b,tudong_off_ssh_1 - {{user}} in AllowUsers,cat /etc/ssh/sshd_config | grep -v ^# | grep -w AllowUsers | grep -w {{user}},raw,non_empty,
47a,tudong_off_ssh_2 - TMOUT=300 count,cat /etc/profile | grep -v ^# | grep 'TMOUT=300' | wc -l,raw,int_eq,1
48a,bandwidth_net - list active interfaces,ip a | grep 'state UP' | awk '{print $2}' | awk -F: '{print $1}',per_line:iface,per_line:non_empty,
48b,bandwidth_net - {{iface}} speed >=1000,ethtool {{iface}} | grep Speed | awk '{print $2}' | awk -FM '{print $1}',raw,int_ge,1000
49a,openssl_ver - whitelist check,openssl version -a,per_line:raw,contains_any,1.0.1e|1.0.2k|1.0.1u|1.0.2j|1.1.0a|1.1.0g|1.0.2n|1.1.1k|3.2.2
50a,file_unowner - no unowned files,find / -xdev \( -nouser -o -nogroup \) -print,raw,empty,
51a,bien_moitruong - PATH not unsafe,echo $PATH | grep '\./\|::\|/tmp',raw,empty,
52a,cau_hinh_crontab1 - cron.deny removed,ls /etc/ | grep cron.deny,raw,empty,
53a,cau_hinh_crontab2 - cron.allow exists,ls /etc/ | grep cron.allow,raw,non_empty,
54a,cau_hinh_crontab_min - no other crontab entries,crontab -l | grep -v ^# | grep -v sd_agent | grep -v scms-agent,raw,empty,
54b,cau_hinh_crontab_min - has sd_agent entry,crontab -l | grep -v ^# | grep sd_agent | grep sd_agent_monitor.sh,raw,non_empty,
54c,cau_hinh_crontab_min - has scms_agent entry,crontab -l | grep -v ^# | grep scms-agent | grep scms-mon,raw,non_empty,
55a,rsyslog1 - check each token in logrotate rsyslog,cat /etc/logrotate.d/rsyslog | grep -v ^#,per_line:raw,contains,/var/log/syslog|/var/log/mail.info|/var/log/mail.warn|/var/log/mail.err|/var/log/mail.log|/var/log/kern.log|/var/log/auth.log|/var/log/cron.log|/var/log/debug|/var/log/messages|{|compress|sharedscripts|postrotate|/usr/lib/rsyslog/rsyslog-rotate|endscript|}
56a,rsyslog2_1 - logrotate.conf tokens,cat /etc/logrotate.conf | grep -v ^#,per_line:raw,contains,weekly|rotate 12|create|dateext|include /etc/logrotate.d
57a,rsyslog2_2 - logrotate btmp tokens,cat /etc/logrotate.d/btmp | grep -v ^#,per_line:raw,contains,/var/log/btmp {|create 0660 root utmp|}
58a,rsyslog2_3 - logrotate wtmp tokens,cat /etc/logrotate.d/wtmp | grep -v ^#,per_line:raw,contains,/var/log/wtmp {|create 0664 root utmp|}
59a,rsyslog3_1 - logrotate cmdlog tokens,cat /etc/logrotate.d/cmdlog | grep -v ^#,per_line:raw,contains,/var/log/cmdlog.log|{|compress|weekly|rotate 12|sharedscripts|postrotate|/usr/lib/rsyslog/rsyslog-rotate|endscript|}
60a,rsyslog3_2 - logrotate iptables tokens,cat /etc/logrotate.d/iptables | grep -v ^#,per_line:raw,contains,/var/log/iptables.log|{|daily|rotate 30|copytruncate|compress|notifempty|missingok|}
61a,rsyslog3_3 - kern.debug → /var/log/iptables.log count,cat /etc/rsyslog.d/50-default.conf | grep -v ^# | grep 'kern.debug' | grep '/var/log/iptables.log' | wc -l,raw,int_eq,1
62a,rsyslog3_4 - local6 → /var/log/cmdlog.log count,cat /etc/rsyslog.d/50-default.conf | grep -v ^# | grep 'local6' | grep '/var/log/cmdlog.log' | wc -l,raw,int_eq,1
63a,iptables_persistent - package available,dpkg -l | grep iptables-persistent,raw,non_empty,
64a,zone_reclaim_mode - must be 0,cat /proc/sys/vm/zone_reclaim_mode,raw,int_eq,0
65a,mysql_not_active - no mysql process (non-root),ps -ef | grep mysql | grep -v ^root,raw,empty,
66a,phan_vung_swap - swap entries exist,cat /proc/swaps | tail -n+2,raw,non_empty,
67a,oracle_scan_order - file presence,test -e /etc/sysconfig/oracleasm && echo present || echo absent,raw,eq,absent
67b,oracle_scan_order - ORACLEASM_SCANORDER has dm,cat /etc/sysconfig/oracleasm | grep -v ^# | grep ORACLEASM_SCANORDER | grep -i dm | wc -l,raw,int_ge,1
67c,oracle_scan_order - ORACLEASM_SCANEXCLUDE has sd,cat /etc/sysconfig/oracleasm | grep -v ^# | grep ORACLEASM_SCANEXCLUDE | grep -i sd | wc -l,raw,int_ge,1
68a,haveged_service_on - detect VM (Vmware/OpenStack),dmidecode -t system | grep -i 'Vmware\|OpenStack',raw,non_empty,
68b,haveged_service_on - haveged installed,dpkg -s haveged | grep 'ok installed',raw,non_empty,
68c,haveged_service_on - haveged running,systemctl status haveged 2>/dev/null | grep running,raw,non_empty,
69a,basic_package - telnet,dpkg --get-selections | grep -w telnet,raw,non_empty,
69b,basic_package - sysstat,dpkg --get-selections | grep -w sysstat,raw,non_empty,
69c,basic_package - lsof,dpkg --get-selections | grep -w lsof,raw,non_empty,
69d,basic_package - dmidecode,dpkg --get-selections | grep -w dmidecode,raw,non_empty,
69e,basic_package - net-tools,dpkg --get-selections | grep -w net-tools,raw,non_empty,
69f,basic_package - pciutils,dpkg --get-selections | grep -w pciutils,raw,non_empty,
69g,basic_package - iptables,dpkg --get-selections | grep -w iptables,raw,non_empty,
69h,basic_package - iptables-persistent,dpkg --get-selections | grep -w iptables-persistent,raw,non_empty,
69i,basic_package - netfilter-persistent,dpkg --get-selections | grep -w netfilter-persistent,raw,non_empty,
69j,basic_package - ntp,dpkg --get-selections | grep -w ntp,raw,non_empty,
69k,basic_package - ftp,dpkg --get-selections | grep -w ftp,raw,non_empty,
69l,basic_package - nmap,dpkg --get-selections | grep -w nmap,raw,non_empty,
69m,basic_package - iotop,dpkg --get-selections | grep -w iotop,raw,non_empty,
69n,basic_package - wget,dpkg --get-selections | grep -w wget,raw,non_empty,
69o,basic_package - zip,dpkg --get-selections | grep -w zip,raw,non_empty,
69p,basic_package - unzip,dpkg --get-selections | grep -w unzip,raw,non_empty,
69q,basic_package - sysfsutils,dpkg --get-selections | grep -w sysfsutils,raw,non_empty,
69r,basic_package - traceroute,dpkg --get-selections | grep -w traceroute,raw,non_empty,
69s,basic_package - e2fsprogs,dpkg --get-selections | grep -w e2fsprogs,raw,non_empty,
70a,repo_taptrung - HTTP 200,"curl --connect-timeout 3 -s -o /dev/null -I -w ""%{http_code}"" 10.254.144.164:8081",raw,eq,200
71a,ntp_service - must be active,systemctl status ntp | grep 'Active: active',raw,non_empty,
72a,config_ntp1 - has ntp server,cat /etc/ntp.conf | grep -v ^# | grep @{ntp_server},raw,non_empty,
73a,config_ntp2 - logfile path exists,"test -f ""$(cat /etc/ntp.conf | grep -v ^# | grep logfile | awk '{print $2}')"" && echo exists || echo missing",raw,eq,exists
74a,config_ntp3 - logfile directive count,cat /etc/ntp.conf | grep -v ^# | grep logfile | wc -l,raw,int_eq,1
74b,config_ntp3 - logrotate has that file,"grep -F ""$(cat /etc/ntp.conf | grep -v ^# | grep logfile | awk '{print $2}')"" /etc/logrotate.d/syslog",raw,non_empty,
75a,time_synchronization1 - write sync probe,ntpdate -q 192.168.181.50 > /root/check_time_sync.txt,raw,non_empty,
75b,time_synchronization1 - probe file has content,cat /root/check_time_sync.txt | wc -l,raw,int_ge,1
76a,time_synchronization2 - offset != 0.000000,"cat /root/check_time_sync.txt | grep delay | awk '{print $6}' | cut -d',' -f1",raw,neq,0
77a,time_synchronization3 - offset seconds part allowed,cat /root/check_time_sync.txt | grep delay | awk '{print $6}' | cut -d'.' -f1,raw,in,0|-0|+0
78a,swappiness - value <= 10,cat /proc/sys/vm/swappiness,raw,int_le,10
79a,lldp_service - detect VMware/RDO,dmidecode -t system | grep -w 'VMware\|RDO',raw,non_empty,
79b,lldp_service - lldpd installed (physical),dpkg -s lldpd | grep 'ok installed',raw,non_empty,
80a,netfilter_persistent - service available,systemctl status netfilter-persistent | grep 'Active:\ active',raw,non_empty,
81a,iptables1 - last INPUT rule is DROP/REJECT,iptables -S INPUT | tail -1 | grep '\-A INPUT \-j DROP\|\-A INPUT \-j REJECT',raw,non_empty,
82a,iptables2 - INPUT has LOG before last,iptables -S INPUT | tail -2 | head -1 | grep '\-A INPUT \-j LOG',raw,non_empty,
83a,iptables3 - last OUTPUT rule is DROP/REJECT,iptables -S OUTPUT | tail -1 | grep '\-A OUTPUT \-j DROP\|\-A OUTPUT \-j REJECT',raw,non_empty,
84a,iptables4 - OUTPUT has LOG before last,iptables -S OUTPUT | tail -2 | head -1 | grep '\-A OUTPUT \-j LOG',raw,non_empty,
85a,cmdlog1 - new cmdlog config present,cat /etc/bash.bashrc | grep -v ^# | grep 'local6.debug' | grep ctty,raw,non_empty,
86a,cmdlog2 - PROMPT_COMMAND count == 1,cat /etc/bash.bashrc | grep -v ^# | grep 'export PROMPT_COMMAND' | grep 'local6.debug' | wc -l,raw,int_eq,1
