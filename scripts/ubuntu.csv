ID,Command Name,Command,Comparator,Reference Value
1,tach_var_ra_khoi_source,dmidecode -t system | grep -qw RDO && echo 1 || (grep -qw /var /etc/fstab && echo 1 || echo 0),int_eq,1
2,phan_vung_ud_ko_nam_chung_source,grep -v ^# /etc/fstab | grep -vw "/\|/var\|/dev/shm\|/home\|/usr\|/proc\|/sys\|/dev/pts\|/opt\|swap\|/boot\|/boot/efi" | head -n1,non_empty,
3,timezone,date +"%z",contains,0700
4,sudoers1,grep -v ^# /etc/sudoers | grep -x "%sudo\tALL=(ALL:ALL) ALL",empty,
5,sudoers2,grep -v ^# /etc/sudoers | grep -x "%admin ALL=(ALL) ALL",empty,
6,sudoers3,awk -F: '($3>=400)&&($1!="nfsnobody")&&($7~/sh$/){print $1}' /etc/passwd | xargs -r -I{} grep -w {} /etc/sudoers | grep "ALL=(ALL:ALL) ALL",empty,
7,ud_ko_dung_root,ps -ef | awk '$1=="root" && $8 ~ /(java|tomcat|jre|jdk|kubelet)/{print $8}' ,empty,
8,duphong_bond1,ps -ef | awk '$1=="root" && $8 ~ /(java|tomcat|jre|jdk|kubelet)/{print $8}' ,empty,
9,duphong_bond2,dmidecode -t system | grep -Eq "VMware|RDO" && echo 1 || ( bonds=$(ip -o link show | awk -F': ' '$2 ~ /^bond[0-9]/{print $2}'); [ -z "$bonds" ] && echo 0 || awk '/Slave Interface/ {s++} /MII Status:/ && $3!="up"{d++} END{print (s>=2 && d==0)?1:0}' /proc/net/bonding/$bonds ),int_eq,1
10,duphong_bond3,dmidecode -t system | grep -Eq "VMware|RDO" && echo 1 || (bonds=$(ip -o link show | awk -F': ' '$2 ~ /^bond[0-9]/{print $2}'); [ -z "$bonds" ] && echo 0 || awk -v cfg="$(grep -o 'mode=[0-9]' /etc/sysconfig/network-scripts/ifcfg-$bonds | cut -d= -f2)" '/Bonding Mode/ {m=$0} END{ok=(cfg=="0" && m~"round-robin")||(cfg=="1" && m~"active-backup")||(cfg=="2" && m~"xor")||(cfg=="4" && m~"802.3ad")||(cfg=="5" && m~"transmit load balancing"); print ok?1:0}' /proc/net/bonding/$bonds),int_eq,1
11,san_multipath,list=$(dmsetup status | awk '$3!="linear"{print $1}' | sed 's/://g' | grep -vE 'p[0-9]$|No'); [ -z "$list" ] && echo 4 || multipath -ll $list | grep -c "running$",int_ge,4
12,kdump_service,systemctl status kdump-tools | grep "Active: active",non_empty,
13,sendmail_off,systemctl status sendmail | grep "Active: active",empty,
14,postfix_off,systemctl status postfix | grep "Active: active",empty,
15,bash_thay_dash1,cat /etc/passwd | grep -v bash | awk -F: '($3>=1000) {print $1}' | grep -v nobody,empty,
16,bash_thay_dash2,cat /etc/default/useradd | grep -v ^# | grep -w "SHELL=/bin/bash",non_empty,
17,bo_card_mang_ao,ifconfig -a | grep virbr,empty,
18,appamor_disable,systemctl status apparmor | grep "Active: active",empty,
19,nf_conntrack_max,[ -f /proc/sys/net/nf_conntrack_max ] && cat /proc/sys/net/nf_conntrack_max || echo 0,int_ge,524288
20,hashsize,[ -f /proc/sys/net/netfilter/nf_conntrack_buckets ] && cat /proc/sys/net/netfilter/nf_conntrack_buckets || echo 0,int_ge,131072
21,pass_never_expired,awk -F: '($3>=400)&&($1!="nfsnobody")&&($7=="/bin/bash"){print $1}' /etc/passwd | xargs -r -I{} sh -c "chage -l {} | grep 'Password expires' | awk '{print \$4}'" | grep -vc never,int_eq,0
22,max_open_file_user,awk -F: '($3>=400)&&($1!="nfsnobody")&&($7=="/bin/bash"){print $1}' /etc/passwd | xargs -r -I{} sh -c "grep -v ^# /etc/security/limits.conf | grep -w {} | grep -vw soft | grep -qw nofile || echo {}" | wc -l,int_eq,0
23,max_process_user,awk -F: '($3>=400)&&($1!="nfsnobody")&&($7=="/bin/bash"){print $1}' /etc/passwd | xargs -r -I{} sh -c "grep -v ^# /etc/security/limits.conf | grep -w {} | grep -vw soft | grep -qw nproc || echo {}" | wc -l,int_eq,0
25,cupsd_off,systemctl status cups | grep "Active: active",empty,
26,bluetooth_off,systemctl status bluetooth | grep "Active: active",empty,
27,per_user_trong_groupsudo1,grep -v ^# /etc/pam.d/su | grep -x "auth[[:space:]]\+required[[:space:]]\+pam_wheel.so",non_empty,
28,per_user_trong_groupsudo2,awk -F: '($3>=400)&&($1!="nfsnobody")&&($1!="monitor")&&($1!="vt_admin")&&($7~/sh$/){print $1}' /etc/passwd | xargs -r -I{} sh -c "id -nG {} | grep -qw sudo && echo {}" | wc -l,int_eq,0
29,per_user_trong_groupsudo3,awk -F: '($3>=400)&&($1!="nfsnobody")&&($1!="monitor")&&($1!="vt_admin")&&($7~/sh$/){print $1}' /etc/passwd | xargs -r -I{} sh -c "id -nG {} | grep -qw adm && echo {}" | wc -l,int_eq,0
30,password1,dpkg -s libpam-pwquality | grep "ok installed",non_empty,
31,password2,grep -v ^# /etc/security/pwquality.conf | grep -w "minlen = 8",non_empty,
32,password3,grep -v ^# /etc/security/pwquality.conf | grep -w "dcredit = -1",non_empty,
33,password4,grep -v ^# /etc/security/pwquality.conf | grep -w "ucredit = -1",non_empty,
34,password5,grep -v ^# /etc/security/pwquality.conf | grep -w "lcredit = -1",non_empty,
35,password6,grep -v ^# /etc/security/pwquality.conf | grep -w "ocredit = -1",non_empty,
36,password7,grep -v ^# /etc/security/pwquality.conf | grep -w "maxrepeat = 3",non_empty,
37,password8,grep -v ^# /etc/security/pwquality.conf | grep -w "enforcing = 1",non_empty,
38,password9,grep -v ^# /etc/security/pwquality.conf | grep -w "retry = 3",non_empty,
39,password10,grep -v ^# /etc/security/pwquality.conf | grep -w "enforce_for_root",non_empty,
40,pass_encryp_1,grep -v ^# /etc/pam.d/common-password | grep -w password | grep -w pam_unix.so | grep -w sha512,non_empty,
41,pass_encryp_2,grep -v ^# /etc/pam.d/common-password | grep -w password | grep -w pam_pwhistory.so | grep -w "remember=5",non_empty,
42,thuat_toan_mahoa,grep -v ^# /etc/login.defs | grep -w "ENCRYPT_METHOD" | grep -w SHA512,non_empty,
43,cau_hinh_ssh_protocol,grep -v ^# /etc/ssh/sshd_config | grep -w "Protocol 2",non_empty,
44,cau_hinh_ssh_permitrootlogin,grep -v ^# /etc/ssh/sshd_config | grep -w "PermitRootLogin no",non_empty,
45,cau_hinh_ssh_allowusers,awk -F: '($3>=400)&&($1!="nfsnobody")&&($7~/sh$/){print $1}' /etc/passwd | xargs -r -I{} sh -c "grep -v ^# /etc/ssh/sshd_config | grep -w AllowUsers | grep -qw {}",int_eq,0
46,tudong_off_ssh_1,awk -F: '($3>=400)&&($1!="nfsnobody")&&($7~/sh$/){print $1}' /etc/passwd | xargs -r -I{} sh -c "grep -v ^# /etc/ssh/sshd_config | grep -w AllowUsers | grep -qw {}",int_eq,0
47,tudong_off_ssh_2,grep -v ^# /etc/profile | grep "TMOUT=300" | wc -l,int_eq,1
48,bandwidth_net,ip -o link show | awk -F': ' '$3 ~ /UP/{print $2}' | xargs -r -I{} sh -c "ethtool {} | grep Speed | awk '{print \$2}' | awk -FM '{print \$1}'" | awk '{if($1<1000) bad++} END{print bad+0}',int_eq,0
49,openssl_ver,openssl version -a | grep -E "1.0.1e|1.0.2k|1.0.1u|1.0.2j|1.1.0a|1.1.0g|1.0.2n|1.1.1k|3.2.2",non_empty,
50,file_unowner,find / -xdev \( -nouser -o -nogroup \) -print,empty,
51,bien_moitruong,echo $PATH | grep "\./\|::\|/tmp",empty,
52,cau_hinh_crontab1,ls /etc/ | grep cron.deny,empty,
53,cau_hinh_crontab2,ls /etc/ | grep cron.allow,non_empty,
54,cau_hinh_crontab_min,(crontab -l | grep -v ^# | grep -v "sd_agent" | grep -v "scms-agent"; crontab -l | grep -v ^# | grep sd_agent | grep sd_agent_monitor.sh; crontab -l | grep -v ^# | grep scms-agent | grep scms-mon) | wc -l,int_eq,2
55,rsyslog1,grep -v ^# /etc/logrotate.d/rsyslog | grep -E "/var/log/syslog|/var/log/mail.info|/var/log/mail.warn|/var/log/mail.err|/var/log/mail.log|/var/log/kern.log|/var/log/auth.log|/var/log/cron.log|/var/log/debug|/var/log/messages|\\{|compress|sharedscripts|postrotate|/usr/lib/rsyslog/rsyslog-rotate|endscript|\\}",non_empty,
56,rsyslog2_1,grep -v ^# /etc/logrotate.conf | grep -E "weekly|rotate 12|create|dateext|include /etc/logrotate.d",non_empty,
57,rsyslog2_2,grep -v ^# /etc/logrotate.d/btmp | grep -E "/var/log/btmp|create 0660 root utmp|\\{|\\}",non_empty,
58,rsyslog2_3,grep -v ^# /etc/logrotate.d/wtmp | grep -E "/var/log/wtmp|create 0664 root utmp|\\{|\\}",non_empty,
59,rsyslog3_1,grep -v ^# /etc/logrotate.d/cmdlog | grep -E "/var/log/cmdlog.log|\\{|compress|weekly|rotate 12|sharedscripts|postrotate|/usr/lib/rsyslog/rsyslog-rotate|endscript|\\}",non_empty,
60,rsyslog3_2,grep -v ^# /etc/logrotate.d/iptables | grep -E "/var/log/iptables.log|\\{|daily|rotate 30|copytruncate|compress|notifempty|missingok|\\}",non_empty,
61,rsyslog3_3,grep -v ^# /etc/rsyslog.d/50-default.conf | grep "kern.debug" | grep "/var/log/iptables.log" | wc -l,int_eq,1
62,rsyslog3_4,grep -v ^# /etc/rsyslog.d/50-default.conf | grep "local6" | grep "/var/log/cmdlog.log" | wc -l,int_eq,1
63,iptables_persistent,dpkg -l | grep iptables-persistent,non_empty,
64,zone_reclaim_mode,cat /proc/sys/vm/zone_reclaim_mode,int_eq,0
65,mysql_not_active,ps -ef | grep mysql | grep -v ^root,empty,
66,phan_vung_swap,tail -n+2 /proc/swaps,non_empty,
67,oracle_scan_order,[ -e /etc/sysconfig/oracleasm ] && awk -F= '/^ORACLEASM_SCANORDER/ && /dm/{o++} /^ORACLEASM_SCANEXCLUDE/ && /sd/{x++} END{print (o>0 && x>0)?1:0}' /etc/sysconfig/oracleasm || echo 1,int_eq,1
68,haveged_service_on,dmidecode -t system | grep -iE "Vmware|OpenStack" >/dev/null && systemctl is-active haveged 2>/dev/null | grep -qw active || echo active,eq,active
69,basic_package,dpkg --get-selections | grep -E "telnet|sysstat|lsof|dmidecode|net-tools|pciutils|iptables|iptables-persistent|netfilter-persistent|ntp|ftp|nmap|iotop|wget|zip|unzip|sysfsutils|traceroute|e2fsprogs",non_empty,
70,repo_taptrung,curl --connect-timeout 3 -s -o /dev/null -I -w "%{http_code}" 10.254.144.164:8081,eq,200
71,ntp_service,systemctl is-active ntp 2>/dev/null,eq,active
72,config_ntp1,grep -v ^# /etc/ntp.conf | grep "@{ntp_server}",non_empty,
73,config_ntp2,grep -v ^# /etc/ntp.conf | grep logfile | awk '{print $2}' | xargs -r test -f && echo 1 || echo 0,int_eq,1
74,config_ntp3,log=$(grep -v ^# /etc/ntp.conf | grep logfile | awk '{print $2}'); [ -n "$log" ] && grep -q "$log" /etc/logrotate.d/syslog && echo 1 || echo 0,int_eq,1
75,time_synchronization1,ntpdate -q 192.168.181.50 | grep offset | wc -l,int_ge,1
76,time_synchronization2,"cat /root/check_time_sync.txt | grep delay | awk '{print $6}' | cut -d',' -f1",int_neq,0.000000
77,time_synchronization3,cat /root/check_time_sync.txt | grep delay | awk '{print $6}' | cut -d'.' -f1,in,"0,-0,+0"
78,swappiness,cat /proc/sys/vm/swappiness,int_le,10
79,lldp_service,dmidecode -t system | grep -Eq "VMware|RDO" && echo 1 || (dpkg -s lldpd | grep -q "ok installed" && echo 1 || echo 0),int_eq,1
80,netfilter_persistent,systemctl is-active netfilter-persistent 2>/dev/null,eq,active
81,iptables1,iptables -S INPUT | tail -1 | grep -E "\-A INPUT \-j (DROP|REJECT)",non_empty,
82,iptables2,iptables -S INPUT | tail -2 | head -1 | grep "\-A INPUT \-j LOG",non_empty,
83,iptables3,iptables -S OUTPUT | tail -1 | grep -E "\-A OUTPUT \-j (DROP|REJECT)",non_empty,
84,iptables4,iptables -S OUTPUT | tail -2 | head -1 | grep "\-A OUTPUT \-j LOG",non_empty,
85,cmdlog1,grep -v ^# /etc/bash.bashrc | grep "local6.debug" | grep ctty,non_empty,
86,cmdlog2,grep -v ^# /etc/bash.bashrc | grep "export PROMPT_COMMAND" | grep "local6.debug" | wc -l,int_eq,1

